# 时间序列模型
1. 熟悉时间序列分解
2. 掌握STL分解和ARIMA模型
3. 利用工具对资金流入流出数据进行建模预测

## 时间序列分解
- 时间序列是指将同一统计量的数值按其发生的时间先后顺序排列而成的数列
- 常用按时间顺序排列的一组随机变量表示一个随机事件的时间序列，简记为 {𝑋 }

- 时间序列的各种变化都可以归纳成四大类因素的综合影响
  - 长期趋势(trend):会导致序列出现明显的长期趋势
  - 循环波动(circle):会导致序列呈现出周期性波动
  - 季节性变化(season): 会导致序列呈现出和季节变化相关的稳定的周期波动.
  - 随机波动(immediate): 纯随机、与时间无关

- 季节变动视为一种特殊的循环波动

- 可采用加法结构或乘法结构分解时间序列
  - 加法模型: 
      $$
      𝒙_𝒕 =𝑻_𝒕 +𝑪_𝒕 +𝑺_𝒕 +𝑰_𝒕
      $$
      
  - 乘法模型：
      $$
      𝒙𝒕 =𝑻_𝒕 ×𝑪_𝒕 ×𝑺_𝒕 ×𝑰_𝒕
    $$
  
  - 趋势 周期 季节 随机
  
  - 加法乘法的混合分解：
      $$
      𝒙_𝒕 = 𝑩𝒂𝒔𝒆 × (𝑪𝒚𝒄𝒍𝒆_𝒕 + 𝑹𝒆𝒔𝒊𝒅𝒂𝒖𝒍_𝒕)
      $$
      
      
      1. 待预测时段均相同
      2. t 时刻周期项(可采用《03.时间序列规则与baseline》中的周期因子获得)
      3. t 时刻剔除周期项后剩余的残差(这个残差是怎么来的？)
      4. 在真实问题中，趋势项常常不明显，可采用这种方式获得残差，利用天气等协变量对残差建模
  
- STL(Seasonal and Trend decomposition using Loess )分解
  
- 将时间序列分解为周期项(季节项)+趋势项+随机项
    $$
    𝑪_𝒕+𝑻_𝒕+I_t
    $$
    
- STL(Seasonal and Trend decomposition using Loess )分解
  - 可将时间序列分为三类
  - 没有趋势、也没有周期的序列(水平型时间序列)
  -  只有趋势、没有周期的序列(斜坡型时间序列;可分段)
  - 有趋势、有周期的序列(含趋势和周期的时间序列)
-  可采用指数平滑预测各项
  - 水平型时间序列:简单指数平滑 在较短时间间隔内，序列取值是较稳定
    $$
    x^{hat} =𝛼×𝑥 +(1−𝛼)×x^{hat}
    $$
    
  - 斜坡型时间序列:Holt两参数指数平滑 假定序列有一个比较固定的线性趋势
    $$
    x^{hat}_{t+1} =𝛼×𝑥_{t} +(1−𝛼)×(𝑥_{t-1}+ r_{t-1})
    $$
  
    $$
    r^{hat}_{t} =\beta×(𝑥^{hat}_{t+1} - x^{hat}_t) +(1−\beta)×r_{t}
    $$
  
    $$
    r_1 = x_2 - x_1
    $$
  
    $$
    r_1 = [(𝑥_2−𝑥_1) +(𝑥_3−𝑥_2) +(𝑥_4−𝑥_3)]/3
    $$
  
    $$
    r_1 = \frac{x_n - x_1}{n-1}
    $$
  
    
  
  -  含趋势和周期的时间序列:Holt-winters三参数指数平滑 假定序列既有趋势、又含周期; 若没有趋势，则𝑟 趋向0

$$
x^{hat}_{t+1} =𝛼×(𝑥_t −𝑠_{t-\pi} )+(1−𝛼)×(𝑥_t +𝑟_{t-1} )
$$

$$
r^{hat}_{t} =\beta×(𝑥^{hat}_{t+1} - x^{hat}_t) +(1−\beta)×r_{t}
$$

$$
S^{hat}_t = \gamma × (x_t- x^{hat}_{t+1})+(1-\gamma)×S_{t-\pi}
$$
# ARIMA模型
Auto Regressive Integrated Moving Average model(整合移动平均自回归模型)
- 𝐴𝑅𝐼𝑀𝐴(𝑝, 𝑑, 𝑞)
- 在ARMA模型的基础上使用差分法解决非平稳序列（d阶差分）   过差分会丢失信息
  $$
  \Phi(B)\nabla^{d}x_t=\Theta(B)\epsilon_t
  $$
- 𝐵为延迟算子
  $$
  𝑥_{𝑡−1}=𝑥_𝑡×𝐵
  $$
- 𝛻𝑑为差分多项式
  $$
  𝛻^𝑑 = (1 − 𝐵)^𝑑
  $$
- Φ(B)为自回归多项式
$$
Φ(B)=1−𝜑_1 𝐵 − ⋯ − 𝜑_p 𝐵^𝑝
$$
- 𝛩(𝐵)为滑动平均多项式
$$
𝛩(𝐵)=1−𝜃_1𝐵−⋯−𝜃_q𝐵^𝑞
$$

# ARMA模型
- Auto Regressive Moving Average model(整合移动平均自回归模型)
- ARMA(p, q)
## ARMA 模型假定
- 残差序列零均值等方差

- 残差序列彼此不相关

- 不同时间的序列值与残差不相关

### 预处理
- 用差分运算将其变为平稳序列
	- 严格平稳
	- 宽平稳
		- 方差不大
		- 有个统计平均
	
- 若是非白噪声则将其建模
- 纯随机检验 眼假设是该序列是白噪声序列
	- Box-Pierce检验
		- 适用于大样本情况
	Ljung-Box检验
		- 适用于小样本情况
- 差分运算至序列稳定且通过白噪声检验的最小差分阶数即为d的取值

- 平稳非白噪声的情况下通过ACF/PACF图对其进行定界 建模

- 自相关函数
  - 时间序列观测值与其过去的观测值之间的线性相关性
- 偏自相关系数
  - 在剔除中间k-1个随机变量的干扰后，t-k时刻观测值与t时刻观测值的相关性
























