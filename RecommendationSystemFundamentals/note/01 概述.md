###  常用评测指标

1. **用户满意度**
可以通过购买率度量用户的满意度,与购买率类似的点击率,用户停留时间和转化率等指标都可以用来度量用户的满意度.

2. **预测准确度**

   预测准确度是用来度量用户的实际行为与推荐系统预测结果的准确度

   1. **评分预测**
   均方根误差(RMSE)和平均绝对误差(MAE)计算
   RMSE由于存在平方项，使得使得用户真实评分与推荐系统预测评分相差较大的用户加大了惩罚，即该评测指标对系统要求更加的苛刻

   2. **TopN推荐**
      推荐系统在给用户推荐物品的时候,往往会给用户一个列表的推荐物品,这种场景下的推荐成为是TopN推荐
      - 精确率(precision)
      - - 召回率(recall)

3. **覆盖率**

   覆盖率是用来描述一个推荐系统对物品长尾的发掘能力,一个简单的定义可以是:推荐系统所有推荐出来的商品集合数占总物品集合数的比例.

   信息熵定义覆盖率: 其中$p(i)$是物品$i$的流行度除以所有物品流行度之和
   基尼系数定义覆盖率: 其中$i_j$是按照物品流行度p从小到大排序的物品列表中第$j$个物品

4. **多样性**
   度量推荐列表中物品的多样性换句话说就是度量推荐列表中所有物品之间的不相似性

5. **新颖性**

   满足推荐的新颖性最简单的方法就是给用户推荐他们之前没有看过的物品,但是每个用户没见过的物品数量是非常庞大的,所以一般会计算推荐物品的平均流行度,流行度越低的物品越有可能让用户觉得新颖,因此,如果推荐结果中的物品平均热门程度比较低说明推荐的结果就可能比较新颖.

6. **AUC曲线**

   AUC（Area Under Curve），ROC曲线下与坐标轴围成的面积
   
   在讲AUC前需要理解混淆矩阵，召回率，精确率，ROC曲线等概念
   
   <img src="http://ryluo.oss-cn-chengdu.aliyuncs.com/Java11525720-7131daae2ff90acb.png" alt="img" style="zoom:67%;" />
   
   TP：真的真了（真实值是真的，预测也是真）
   
   FN：真的假了（真实值是真的，预测为假了）
   
   FP：假的真了（真实值是假的，预测为真了）
   
   TN：假的假了（真实值是假的，预测也是假）
   
   召回率与准确率(上述已经进行了说明)，下面是另一种形势的定义，本质上都是一样的：

<br>

### 召回

#### 召回层在推荐系统架构中的位置及作用

**1. 召回阶段负责将海量的候选集快速缩小为几万到几千的规模；**

**2. 排序层则负责对缩小后的候选集进行精准排序**。

所以在召回阶段往往会利用少量的特征和简单的模型对大规模的数据集进行快速的筛选，而在排序层一般会使用更多的特征和更加复杂的模型进行精准的排序。

<br>

**下面是召回层与排序层的特点**

- **召回层：**待计算的候选集合大、计算速度快、模型简单、特征较少，尽量让用户感兴趣的物品在这个阶段能够被快速召回，即保证相关物品的召回率

- **排序层：**首要目标是得到精准的排序结果。需要处理的物品数量少，可以利用较多的特征，使用比较复杂的模型。

<br>

在设计召回层时，“计算速度”和“召回率”其实是矛盾的两个指标，为提高“计算速度”，需要使召回策略尽量简单一些；而为了提高“召回率”，要求召回策略尽量选出排序模型所需要的候选集，这也就要求召回策略不能过于简单。在权衡计算速度和召回率后，目前工业界主流的召回方法是采用多个简单策略叠加的“多路召回策略”

<br>

#### 3.2 **多路召回策略**

所谓的“多路召回”策略，就是指采用不同的策略、特征或简单模型，分别召回一部分候选集，然后把候选集混合在一起供后续排序模型使用，可以明显的看出，“多路召回策略”是在“计算速度”和“召回率”之间进行权衡的结果。其中，各种简单策略保证候选集的快速召回，从不同角度设计的策略保证召回率接近理想的状态，不至于损伤排序效果。

如下图是多路召回的一个示意图，在多路召回中，每个策略之间毫不相关，所以一般可以写并发多线程同时进行，这样可以更加高效。

<img src="https://img-blog.csdnimg.cn/20200717201411367.png#pic_center" alt="img" style="zoom: 33%;" />

上图只是一个多路召回的例子，也就是说可以使用多种不同的策略来获取用户排序的候选商品集合，**而具体使用哪些召回策略其实是与业务强相关的**，针对不同的任务就会有对于该业务真实场景下需要考虑的召回规则。例如视频推荐，召回规则可以是“热门视频”、“导演召回”、“演员召回”、“最近上映“、”流行趋势“、”类型召回“等等。

<br>

**多路召回存在的问题**

虽然多路召回权衡了计算速度和召回率的问题，可以使得用于排序的候选商品更加的丰富，但是实际的多路召回仍然存在一些问题。如上图所示，对于每一路召回都会从商品集合中拉回K个商品，这里的K是一个超参数，对于K的选择一般需要通过离线评估加线上的A/B测试来确定合理的K值。除此之外，对于不同的任务具体策略的选择也是人工基于经验的选择，选择的策略之间的信息是割裂的，无法总和考虑不同策略对一个物品的影响。

**基于上述问题，Embedding召回是一个综合性强且计算速度也能满足需求的召回方法。**

<br>

#### 3.3 **Embedding召回**

在当前的主流推荐系统中，Embedding的身影已经无处不在，从一定意义上可以说，把Embedding做好了，整个推荐系统的一个难题就攻克了，下面会从什么是Embedding，常见的Embedding技术有哪些，以及如何用Embedding做召回进行一个简单的总结。

<br>

**Embedding是什么？**

Embedding其实是一种思想，主要目的是将稀疏的向量(如one-hot编码)表示转换成稠密的向量，下图直观的显示了one-hot编码和Embedding表示的区别于联系，即Embedding相当于是对one-hot做了平滑，而onehot相当于是对Embedding做了max pooling。

<img src="https://pic3.zhimg.com/v2-1ded42011e9dd14893d7872074b808d8_r.jpg" alt="preview" style="zoom: 45%;" />

<br>

**常见的Embedding技术有哪些？**

目前主流的Embedding技术主要可以分为三大类。

- text embedding
- image embedding
- graph embedding

在推荐系统领域，text embedding技术是目前使用最多的embedding技术，对于文本特征可以直接使用该技术，**对于非文本的id类特征，可以先将其转化成id序列再使用text embedding的技术获取id的embedding再做召回**。

常见的text Embedding的技术有：

- 静态向量：word2vec, fasttext, glove
- 动态向量：ELMO, GPT, BERT

<br>

对于image embedding其实主要是对于有图或者视频的特征，目前计算机视觉模型已经发展的比较成熟了，对于图像与视频的识别都有效果比较好的模型，大部分都是卷积模块通过各种连接技巧搭建的高效模型，可以使用现有的预训练模型提取图像或者视频的向量特征，然后用于召回。

<br>

对于社交网络相关的推荐，进行推荐的用户与用于之间或者商品之间天然的存在某种复杂的图结构的关系，如何利用图中节点与节点之间的关系对其进行向量化是非常关键的，在这种场景下基于序列的text embedding和基于卷积模型的image embedding都显得力不从心，在这样的背景下Graph Embedding逐渐在推荐系统中流行起来。经典的Graph Embedding模型有, Deep Walk, Node2Vec，LINE以及比较新的阿里巴巴2018年公布的EGES graph Embedding模型。

<br>

### 4. 课后思考

**1. 为什么使用AUC**

> 例如0.7的AUC，其含义可以大概理解为：给定一个正样本和一个负样本，在70%的情况下，模型对正样本的打分高于对负样本的打分。可以看出这个解释下，我们关心的只有正负样本之间的分数高低，而具体的分支则无关紧要
>
> 【多高的AUC才算高】：
>
> 参考文章 https://zhuanlan.zhihu.com/p/24217322

<br>

**2. 如何使用Embedding做召回？**

参考腾讯的**[推荐系统 embedding 技术实践总结](https://zhuanlan.zhihu.com/p/143763320)**

<br>



### 5. 参考资料

* 王喆-《深度学习推荐系统》
* [推荐系统召回策略之多路召回与Embedding召回：https://blog.csdn.net/luanfenlian0992/article/details/107416438](https://blog.csdn.net/luanfenlian0992/article/details/107416438)
* [推荐系统 embedding 技术实践总结：https://zhuanlan.zhihu.com/p/143763320](https://zhuanlan.zhihu.com/p/143763320)

